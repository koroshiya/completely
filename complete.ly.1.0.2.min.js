function completely(a,b){function m(a){return void 0===k&&(k=document.createElement("span"),k.style.visibility="hidden",k.style.position="fixed",k.style.outline="0",k.style.margin="0",k.style.padding="0",k.style.border="0",k.style.left="0",k.style.whiteSpace="pre",k.style.fontSize=b.fontSize,k.style.fontFamily=b.fontFamily,k.style.fontWeight="normal",document.body.appendChild(k)),k.innerHTML=String(a).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),k.getBoundingClientRect().right}b=b||{},b.fontSize=b.fontSize||"16px",b.fontFamily=b.fontFamily||"sans-serif",b.promptInnerHTML=b.promptInnerHTML||"",b.color=b.color||"#333",b.hintColor=b.hintColor||"#aaa",b.backgroundColor=b.backgroundColor||"#fff",b.dropDownBorderColor=b.dropDownBorderColor||"#aaa",b.dropDownZIndex=b.dropDownZIndex||"100",b.dropDownOnHoverBackgroundColor=b.dropDownOnHoverBackgroundColor||"#ddd",b.ignoreCase=b.ignoreCase||!1;var c=document.createElement("input");c.type="text",c.spellcheck=!1,c.style.fontSize=b.fontSize,c.style.fontFamily=b.fontFamily,c.style.color=b.color,c.style.backgroundColor=b.backgroundColor,c.style.width="100%",c.style.outline="0",c.style.border="0",c.style.margin="0",c.style.padding="0";var d=c.cloneNode();d.disabled="",d.style.position="absolute",d.style.top="0",d.style.left="0",d.style.borderColor="transparent",d.style.boxShadow="none",d.style.color=b.hintColor,c.style.backgroundColor="transparent",c.style.verticalAlign="top",c.style.position="relative";var e=document.createElement("div");e.style.position="relative",e.style.outline="0",e.style.border="0",e.style.margin="0",e.style.padding="0";var f=document.createElement("div");if(f.style.position="absolute",f.style.outline="0",f.style.margin="0",f.style.padding="0",f.style.border="0",f.style.fontSize=b.fontSize,f.style.fontFamily=b.fontFamily,f.style.color=b.color,f.style.backgroundColor=b.backgroundColor,f.style.top="0",f.style.left="0",f.style.overflow="hidden",f.innerHTML=b.promptInnerHTML,f.style.background="transparent",void 0===document.body)throw"document.body is undefined. The library was wired up incorrectly.";document.body.appendChild(f);var g=f.getBoundingClientRect().right;e.appendChild(f),f.style.visibility="visible",f.style.left="-"+g+"px",e.style.marginLeft=g+"px",e.appendChild(d),e.appendChild(c);var h=document.createElement("div");h.style.position="absolute",h.style.visibility="hidden",h.style.outline="0",h.style.margin="0",h.style.padding="0",h.style.textAlign="left",h.style.fontSize=b.fontSize,h.style.fontFamily=b.fontFamily,h.style.backgroundColor=b.backgroundColor,h.style.zIndex=b.dropDownZIndex,h.style.cursor="default",h.style.borderStyle="solid",h.style.borderWidth="1px",h.style.borderColor=b.dropDownBorderColor,h.style.overflowX="hidden",h.style.whiteSpace="pre",h.style.overflowY="scroll";var i=function(a){var c=[],d=0,e=-1,f=function(){this.style.outline="1px solid #ddd"},g=function(){this.style.outline="0"},h=function(){i.hide(),i.onmouseselection(this.__hint)},i={hide:function(){a.style.visibility="hidden"},refresh:function(e,j){a.style.visibility="hidden",d=0,a.innerHTML="";var k=window.innerHeight||document.documentElement.clientHeight,l=a.parentNode.getBoundingClientRect(),m=l.top-6,n=k-l.bottom-6;c=[];for(var o=0;o<j.length;o++)if((!b.ignoreCase||0===j[o].toLowerCase().indexOf(e.toLowerCase()))&&0===j[o].indexOf(e)){var p=document.createElement("div");p.style.color=b.color,p.onmouseover=f,p.onmouseout=g,p.onmousedown=h,p.__hint=j[o],p.innerHTML=e+"<b>"+j[o].substring(e.length)+"</b>",c.push(p),a.appendChild(p)}0!==c.length&&(1!==c.length||e!==c[0].__hint)&&(c.length<2||(i.highlight(0),m>3*n?(a.style.maxHeight=m+"px",a.style.top="",a.style.bottom="100%"):(a.style.top="100%",a.style.bottom="",a.style.maxHeight=n+"px"),a.style.visibility="visible"))},highlight:function(a){-1!=e&&c[e]&&(c[e].style.backgroundColor=b.backgroundColor),c[a].style.backgroundColor=b.dropDownOnHoverBackgroundColor,e=a},move:function(b){return"hidden"===a.style.visibility?"":-1===d+b||d+b===c.length?c[d].__hint:(d+=b,i.highlight(d),c[d].__hint)},onmouseselection:function(){}};return i},j=i(h);j.onmouseselection=function(a){c.value=d.value=l+a,n.onChange(c.value),o=c.value,setTimeout(function(){c.focus()},0)},e.appendChild(h),a.appendChild(e);var k,l,o,n={onArrowDown:function(){},onArrowUp:function(){},onEnter:function(){},onTab:function(){},onChange:function(){n.repaint()},startFrom:0,options:[],wrapper:e,input:c,hint:d,dropDown:h,prompt:f,setText:function(a){d.value=a,c.value=a},getText:function(){return c.value},hideDropDown:function(){j.hide()},repaint:function(){var a=c.value,e=n.startFrom,f=n.options,g=f.length,i=a.substring(e);b.ignoreCase&&(i=i.toLowerCase()),l=a.substring(0,e),d.value="";for(var k=0;g>k;k++){var o=f[k];if(b.ignoreCase&&0===o.toLowerCase().indexOf(i)||0===o.indexOf(i)){d.value=l+o;break}}h.style.left=m(l)+"px",j.refresh(i,n.options)}},p=function(a,b){o=a.value;var c=function(){var c=a.value;o!==c&&(o=c,b(c))};a.addEventListener?(a.addEventListener("input",c,!1),a.addEventListener("keyup",c,!1),a.addEventListener("change",c,!1)):(a.attachEvent("oninput",c),a.attachEvent("onkeyup",c),a.attachEvent("onchange",c))};p(c,function(a){n.onChange(a)});var q=function(a){a=a||window.event;var b=a.keyCode;if(33!=b&&34!=b){if(27==b)return j.hide(),d.value=c.value,c.focus(),void 0;if(39!=b&&35!=b&&9!=b)if(13!=b){if(40==b){var g=j.move(1);return""==g&&n.onArrowDown(),d.value=l+g,void 0}if(38==b){var g=j.move(-1);return""==g&&n.onArrowUp(),d.value=l+g,a.preventDefault(),a.stopPropagation(),void 0}d.value=""}else if(0==d.value.length)n.onEnter();else{var f="hidden"==h.style.visibility;if(j.hide(),f)return d.value=c.value,c.focus(),n.onEnter(),void 0;c.value=d.value;var e=o!=c.value;o=c.value,e&&n.onChange(c.value)}else if(9==b&&(a.preventDefault(),a.stopPropagation(),0==d.value.length&&n.onTab()),d.value.length>0){j.hide(),c.value=d.value;var e=o!=c.value;o=c.value,e&&n.onChange(c.value)}}};return c.addEventListener?c.addEventListener("keydown",q,!1):c.attachEvent("onkeydown",q),n}
